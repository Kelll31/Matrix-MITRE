# Просмотрщик матрицы MITRE ATT&CK

Полнофункциональное веб-приложение для просмотра, управления и анализа матрицы MITRE ATT&CK с автоматическим обновлением, интеллектуальным кэшированием и интерактивным пользовательским интерфейсом.

## Описание

Это приложение предоставляет полную реализацию просмотрщика матрицы MITRE ATT&CK с высокопроизводительным бэкендом на FastAPI и современным отзывчивым фронтенднотом. Приложение автоматически загружает и кэширует последние данные MITRE ATT&CK из официального репозитория GitHub, обеспечивая быстрый поиск и комплексный анализ техник и тактик атак.

## Основные возможности

- **FastAPI бэкенд** - Асинхронный, production-ready API с полной типизацией
- **Интерактивный фронтенд** - Современный отзывчивый интерфейс с тёмной темой и плавными анимациями
- **Автоматическое обновление** - Настраиваемые интервалы обновления от 1 часа до 7 дней
- **Умное кэширование** - Локальное JSON кэширование для мгновенного доступа к данным
- **Продвинутый поиск** - Полнотекстовый поиск по названиям, ID, описаниям и платформам
- **Панель статистики** - Точная информация о тактиках, техниках и подтехниках в реальном времени
- **Кроссплатформенность** - Безупречная работа на десктопе, планшете и мобильных устройствах
- **Русский язык** - Полная поддержка кириллицы и локализации
- **Production-ready** - Оптимизировано для развертывания на боевые серверы

## Технологический стек

### Бэкенд
- Python 3.9 и выше
- FastAPI 0.104+ - Современный асинхронный веб-фреймворк с встроенной документацией API
- Uvicorn - ASGI приложение сервер
- aiohttp - Асинхронный HTTP клиент для параллельных запросов
- Pydantic - Валидация данных с использованием type annotations
- python-dotenv - Управление конфигурацией через переменные окружения

### Фронтенд
- HTML5 и CSS3 - Семантическая вёрстка и современные стили
- Vanilla JavaScript (ES6+) - Чистый JavaScript без зависимостей от фреймворков
- Axios - Promise-based HTTP клиент
- Bootstrap 5 CDN - Отзывчивый CSS фреймворк
- Font Awesome 6 - Богатая иконография

### Источник данных
- MITRE ATT&CK Enterprise Framework - Официальный репозиторий с STIX JSON форматом

## Установка и запуск

### Необходимые компоненты

Захерьте, что на вашей системе установлены Python 3.9+ и pip.

### Шаг 1: Клонирование репозитория

```bash
git clone https://github.com/Kelll31/Matrix-MITRE.git
cd Matrix-MITRE
```

### Шаг 2: Создание виртуального окружения

Для Windows:
```bash
python -m venv venv
venv\Scripts\activate
```

Для Linux/macOS:
```bash
python3 -m venv venv
source venv/bin/activate
```

### Шаг 3: Установка зависимостей

```bash
pip install -r requirements.txt
```

### Шаг 4: Запуск приложения

```bash
python main.py
```

Приложение будет доступно по адресу: **http://localhost:8000**

## Справка по API

### Endpoints для получения данных

#### Полная матрица
```
GET /api/matrix
```
Возвращает полную матрицу MITRE ATT&CK со всеми тактиками, техниками и подтехниками.

#### Статистика
```
GET /api/statistics
```

Ответ:
```json
{
  "total_tactics": 14,
  "total_techniques": 234,
  "total_subtechniques": 543,
  "last_update": "2026-01-14T12:34:56",
  "update_interval": "24_hours",
  "is_updating": false,
  "update_count": 5
}
```

#### Все тактики
```
GET /api/matrix/tactics
```
Возвращает список всех доступных тактик с описаниями и сокращениями.

#### Детали тактики
```
GET /api/matrix/tactic/{имя_тактики}
```

Пример: `GET /api/matrix/tactic/persistence`

Возвращает все техники, связанные с указанной тактикой.

#### Техника по ID
```
GET /api/matrix/technique/{техника_id}
```

Примеры:
- `GET /api/matrix/technique/T1001`
- `GET /api/matrix/technique/T1001.001`

Возвращает полную информацию о технике или подтехнике, включая описание, поддерживаемые платформы, методы детекции и внешние ссылки.

#### Техники тактики с фильтрацией
```
GET /api/matrix/tactics/{тактика}/techniques
```

Параметры запроса:
- `platform` (опционально) - Фильтр по платформе (Windows, Linux, macOS и т.д.)
- `limit` (опционально) - Максимальное количество результатов

Пример: `GET /api/matrix/tactics/persistence/techniques?platform=Windows&limit=10`

#### Поиск техник
```
GET /api/search?q={запрос}&limit={лимит}
```

Параметры:
- `q` - Строка поиска (обязательно, минимум 1 символ)
- `limit` - Максимум результатов (по умолчанию: 20, максимум: 100)

Поиск осуществляется по:
- Названиям техник
- ID техник
- Описаниям
- Поддерживаемым платформам

Примеры:
- `GET /api/search?q=T1001` - Поиск по ID
- `GET /api/search?q=Process` - Поиск по описанию
- `GET /api/search?q=Windows&limit=50` - Поиск по платформе с пользовательским лимитом

### Endpoints управления и конфигурации

#### Изменение интервала обновления
```
POST /api/settings/update-interval
Content-Type: application/json

{
  "interval": "24_hours"
}
```

Доступные интервалы:
- `1_hour` - Обновление каждый час
- `6_hours` - Обновление каждые 6 часов
- `12_hours` - Обновление каждые 12 часов
- `24_hours` - Обновление каждый день (по умолчанию)
- `7_days` - Обновление каждую неделю

#### Немедленное обновление
```
POST /api/matrix/refresh
```

Запускает немедленную загрузку и парсинг последней матрицы MITRE ATT&CK с GitHub. Возвращает подтверждение обновления с временной меткой.

## Интервалы обновления

Приложение поддерживает гибкий график автоматических обновлений для баланса между актуальностью данных и потреблением ресурсов:

| Интервал | Длительность | Применение |
|----------|--------------|----------|
| 1_hour | 3600 секунд | Высокочастотный анализ угроз |
| 6_hours | 21600 секунд | Мониторинг в рабочие часы |
| 12_hours | 43200 секунд | Сбалансированный подход |
| 24_hours | 86400 секунд | Ежедневная синхронизация (рекомендуется) |
| 7_days | 604800 секунд | Низконагруженные окружения |

## Пользовательский интерфейс

### Панель управления
- Статистика в реальном времени с количеством тактик, техник и подтехник
- Временная метка последнего обновления с счётчиком обновлений
- Кнопка ручного обновления для немедленного контакта с GitHub
- Выпадающий список для настройки интервала автоматических обновлений

### Матрица тактик
- Полный обзор всех 14 тактик MITRE ATT&CK
- Интерактивные карточки с информацией о каждой тактике
- Количество техник для каждой тактики
- Эффекты наведения и плавные переходы
- Прямая навигация к деталям техник

### Просмотрщик техник
- Комплексный список всех техник выбранной тактики
- ID, название и поддерживаемые платформы для быстрой ориентации
- Расширяемые детали с полными описаниями
- Методы детекции и стратегии смягчения последствий
- Ссылки на официальные страницы MITRE ATT&CK
- Иерархия подтехник и взаимосвязи

### Интерфейс поиска
- Результаты поиска в реальном времени с несколькими критериями сопоставления
- Фильтрация результатов по тактике
- Быстрая навигация к полным деталям техники
- Поддержка пагинации для больших наборов результатов

## Структура проекта

```
Matrix-MITRE/
├── main.py                    # FastAPI приложение со всеми endpoints
├── requirements.txt           # Зависимости Python
├── README.md                  # Документация проекта
├── .gitignore                 # Конфигурация Git ignore
├── cache/                     # Директория локального кэша (создаётся автоматически)
│   ├── mitre_matrix.json      # Кэшированная матрица MITRE ATT&CK
│   └── metadata.json          # Метаданные и временные метки кэша
└── frontend/                  # Веб-интерфейс
    └── index.html             # Полный HTML/CSS/JS интерфейс
```

## Процесс обновления матрицы

### Инициализация приложения
1. Приложение проверяет наличие локального кэша
2. Если кэш существует и действителен, данные загружаются немедленно
3. Если кэш отсутствует или устарел, загрузка происходит с GitHub
4. Запускается фоновая задача для периодических обновлений

### Цикл фонового обновления
1. Ожидание настроенного интервала обновления
2. Загрузка последних данных MITRE ATT&CK в формате STIX JSON
3. Парсинг и валидация структуры данных
4. Построение индексов поиска для быстрых поисков
5. Обновление локальных файлов кэша
6. Логирование завершения обновления с временной меткой
7. Увеличение счётчика обновлений

### Технические детали реализации
- Все сетевые запросы полностью асинхронные (неблокирующие)
- Парсинг JSON включает комплексную обработку ошибок
- Кэширование использует кодировку UTF-8 для полной поддержки кириллицы
- CORS (Cross-Origin Resource Sharing) включен для сценариев интеграции
- Эффективная индексация обеспечивает поиск техник за микросекунды

## Модель данных

Приложение парсит MITRE STIX JSON данные в следующую структуру:

### Объект техники
```json
{
  "id": "T1001",
  "name": "Обфускация данных",
  "description": "Обфускация данных...",
  "platforms": ["Windows", "Linux", "macOS"],
  "tactics": ["command-and-control"],
  "mitre_url": "https://attack.mitre.org/techniques/T1001/",
  "detection": "Метод детекции...",
  "external_references": [...],
  "kill_chain_phases": ["command-and-control"],
  "subtechniques": [...]
}
```

### Объект тактики
```json
{
  "name": "Сохранение доступа",
  "shortname": "persistence",
  "description": "Противник стремится...",
  "techniques": [...]
}
```

## Характеристики производительности

- **Начальная загрузка**: Мгновенная при наличии кэша, 2-5 секунд при первом запуске
- **Поиск техники**: Микросекундный поиск через hash-based индексы
- **Производительность поиска**: Линейный O(n), обычно <100мс для 500 результатов
- **Размер кэша**: Приблизительно 2-3 МБ для полной матрицы
- **Использование памяти**: 50-80 МБ во время выполнения
- **Одновременные запросы**: Поддерживает 100+ одновременных пользователей

## Соображения безопасности

- CORS настроен на принятие запросов со всех источников (измените для production)
- Все входные данные валидируются через Pydantic модели
- Обработка исключений предотвращает утечку информации
- Не хранятся конфиденциальные учетные данные в коде
- Переменные окружения могут использоваться для конфигурации
- В production окружениях используйте HTTPS
- Рассмотрите внедрение rate limiting для production развертывания

## Развертывание

### Локальная разработка
```bash
python main.py
```

### Production с Gunicorn
```bash
pip install gunicorn
gunicorn main:app --workers 4 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000
```

### Развертывание Docker

Создайте Dockerfile:
```dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

Сбор и запуск:
```bash
docker build -t mitre-matrix .
docker run -p 8000:8000 -d mitre-matrix
```

### Сервис Systemd

Создайте `/etc/systemd/system/mitre-matrix.service`:
```ini
[Unit]
Description=MITRE ATT&CK Matrix Service
After=network.target

[Service]
User=www-data
WorkingDirectory=/opt/mitre-matrix
ExecStart=/usr/bin/gunicorn main:app --workers 4 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000
Restart=on-failure

[Install]
WantedBy=multi-user.target
```

Включение и запуск:
```bash
sudo systemctl daemon-reload
sudo systemctl enable mitre-matrix
sudo systemctl start mitre-matrix
```

## Логирование

Приложение выводит подробные логи для мониторинга и отладки:

```
INFO: Application startup complete
INFO: Cache loaded from disk (JSON file)
INFO: MITRE ATT&CK matrix loaded successfully
INFO: Background update task started
INFO: Forcing immediate matrix refresh
INFO: Matrix update completed (update #5)
```

## Обработка ошибок

Приложение включает комплексную обработку ошибок:
- 503 Service Unavailable - Матрица ещё не загружена
- 404 Not Found - Запрошенная техника или тактика не найдена
- 429 Too Many Requests - Обновление уже выполняется
- 400 Bad Request - Неверный параметр интервала обновления

## Статистика кода

- main.py: Приблизительно 650 строк production-ready Python кода
- index.html: Приблизительно 600 строк HTML/CSS/JavaScript
- Всего: Приблизительно 1,250 строк кода
- Не требует внешних инструментов сборки или транспилеров

## Последние обновления (v1.1)

- Исправлено DeprecationWarning для deprecated синтаксиса @app.on_event
- Миграция на современный паттерн FastAPI lifespan контекст-менеджера
- Разрешены проблемы с type annotations при валидации ответов
- Улучшена загрузка JSON с GitHub (обработка text/plain content-type)
- Реализован полнофункциональный интерактивный фронтенд интерфейс
- Улучшена обработка ошибок и логирование везде

## Вклад в проект

Вклады приветствуются! Не стесняйтесь отправлять pull requests с улучшениями, исправлениями ошибок или новыми функциями.

## Лицензия

Этот проект лицензирован под лицензией MIT - см. файл LICENSE для деталей.

## Автор

**Kelll31** - Специалист по пентестированию и кибербезопасности

- GitHub: [Kelll31](https://github.com/Kelll31)
- Специализация: Операции красной команды, анализ угроз, фреймворк MITRE ATT&CK

---

**Создано с фокусом на надежность и удобство использования для специалистов по кибербезопасности**

Последнее обновление: 14 января 2026